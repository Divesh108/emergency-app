<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Black Ops Emergency</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --danger: #e94560;
            --warning: #ff9f1c;
            --safe: #2ec4b6;
            --light: #f8f8f8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: var(--primary);
            color: var(--light);
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        
        /* Disguise Mode - Calculator */
        .calculator-mode {
            display: none;
            flex-direction: column;
            height: 100%;
            background-color: #2d2d2d;
            padding: 15px;
        }
        
        .calculator-display {
            background-color: #444;
            color: white;
            font-size: 2.5rem;
            text-align: right;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            flex: 1;
        }
        
        .calc-btn {
            background-color: #666;
            color: white;
            border: none;
            font-size: 1.3rem;
            padding: 15px 5px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.1s;
            min-height: 50px;
        }
        
        .calc-btn:active {
            transform: scale(0.95);
            background-color: #777;
        }
        
        /* Emergency Mode */
        .emergency-mode {
            display: none;
            flex-direction: column;
            height: 100%;
            padding: 15px;
        }
        
        .emergency-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .emergency-header h1 {
            font-size: 1.5rem;
        }
        
        .emergency-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
            flex: 1;
        }
        
        .emergency-btn {
            border-radius: 15px;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
            cursor: pointer;
            transition: all 0.1s;
            border: none;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            padding: 15px;
            text-align: left;
            position: relative;
        }
        
        .emergency-btn:active {
            transform: scale(0.98);
        }
        
        .emergency-btn img {
            width: 30px;
            height: 30px;
            margin-right: 15px;
        }
        
        .long-press-label {
            font-size: 0.7rem;
            font-weight: normal;
            margin-top: 3px;
            opacity: 0.8;
        }
        
        .robbery-btn { background-color: var(--danger); }
        .medical-btn { background-color: var(--safe); }
        .fire-btn { background-color: var(--warning); }
        .breakdown-btn { background-color: #4e9af1; }
        
        .active-alert {
            position: fixed;
            bottom: 20px;
            left: 15px;
            right: 15px;
            background-color: rgba(233, 69, 96, 0.9);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            display: none;
            z-index: 100;
        }
        
        .active-alert h3 {
            font-size: 1.1rem;
        }
        
        .active-alert p {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .cancel-btn {
            background-color: white;
            color: var(--danger);
            border: none;
            padding: 8px 15px;
            border-radius: 50px;
            margin-top: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        /* Login Screen */
        .login-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
            height: 100%;
            background-color: var(--secondary);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }
        
        .user-type-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 8px;
        }
        
        .user-type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #444;
            border-radius: 8px;
            background: none;
            color: var(--light);
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .user-type-btn.active {
            border-color: var(--safe);
            background-color: rgba(46, 196, 182, 0.2);
        }
        
        .login-input {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            color: white;
            font-size: 0.95rem;
        }
        
        .login-input::placeholder {
            color: #aaa;
        }
        
        .login-btn {
            background-color: var(--safe);
            color: var(--primary);
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            margin-top: 8px;
            cursor: pointer;
        }
        
        .switch-mode {
            text-align: center;
            margin-top: 15px;
            color: var(--safe);
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        /* Officer View */
        .officer-screen {
            display: none;
            flex-direction: column;
            height: 100%;
            padding: 15px;
        }
        
        .officer-map {
            height: 250px;
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
            z-index: 1;
        }
        
        .emergency-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 5px;
        }
        
        .emergency-card {
            background-color: var(--secondary);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        
        .emergency-type {
            color: var(--danger);
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .respond-btn {
            background-color: var(--safe);
            color: var(--primary);
            border: none;
            padding: 8px;
            border-radius: 5px;
            width: 100%;
            margin-top: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .logout-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.8rem;
            z-index: 10;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            padding: 10px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        /* Map marker colors */
        .robbery-marker {
            background-color: var(--danger);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }
        
        .medical-marker {
            background-color: var(--safe);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }
        
        .fire-marker {
            background-color: var(--warning);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }
        
        .breakdown-marker {
            background-color: #4e9af1;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Calculator Disguise -->
    <div class="app-container calculator-mode" id="calculatorMode">
        <button class="back-btn" id="calcBackBtn">← Back to Emergency</button>
        <div class="calculator-display" id="calcDisplay">0</div>
        <div class="calculator-buttons">
            <button class="calc-btn">7</button>
            <button class="calc-btn">8</button>
            <button class="calc-btn">9</button>
            <button class="calc-btn">/</button>
            <button class="calc-btn">4</button>
            <button class="calc-btn">5</button>
            <button class="calc-btn">6</button>
            <button class="calc-btn">*</button>
            <button class="calc-btn">1</button>
            <button class="calc-btn">2</button>
            <button class="calc-btn">3</button>
            <button class="calc-btn">-</button>
            <button class="calc-btn">0</button>
            <button class="calc-btn">.</button>
            <button class="calc-btn">=</button>
            <button class="calc-btn">+</button>
        </div>
    </div>
    
    <!-- Emergency Mode -->
    <div class="app-container emergency-mode" id="emergencyMode">
        <div class="emergency-header">
            <h1>Emergency Alert</h1>
        </div>
        
        <div class="emergency-buttons">
            <button class="emergency-btn robbery-btn" id="robberyBtn">
                <img src="https://cdn-icons-png.flaticon.com/512/1069/1069180.png" alt="Robbery">
                <div>
                    <div>Robbery in Progress</div>
                    <div class="long-press-label">Press to alert | Hold to show calculator</div>
                </div>
            </button>
            <button class="emergency-btn medical-btn" id="medicalBtn">
                <img src="https://cdn-icons-png.flaticon.com/512/2965/2965300.png" alt="Medical">
                Medical Emergency
            </button>
            <button class="emergency-btn fire-btn" id="fireBtn">
                <img src="https://cdn-icons-png.flaticon.com/512/599/599502.png" alt="Fire">
                Fire Emergency
            </button>
            <button class="emergency-btn breakdown-btn" id="breakdownBtn">
                <img src="https://cdn-icons-png.flaticon.com/512/3652/3652191.png" alt="Breakdown">
                Vehicle Breakdown
            </button>
        </div>
        
        <div class="active-alert" id="activeAlert">
            <h3 id="alertType">ROBBERY ALERT ACTIVE</h3>
            <p>Law enforcement has been notified</p>
            <button class="cancel-btn" id="cancelAlertBtn">CANCEL ALERT</button>
        </div>
    </div>
    
    <!-- Login Screen -->
    <div class="app-container login-screen" id="loginScreen">
        <h1 class="login-title">Black Ops Emergency</h1>
        
        <div class="user-type-selector">
            <button class="user-type-btn active" id="pedestrianBtn">Pedestrian</button>
            <button class="user-type-btn" id="officerBtn">Officer</button>
        </div>
        
        <input type="email" class="login-input" id="emailInput" placeholder="Email">
        <input type="password" class="login-input" id="passwordInput" placeholder="Password">
        
        <button class="login-btn" id="loginBtn">LOGIN</button>
        <p class="switch-mode" id="switchMode">Don't have an account? Register</p>
    </div>
    
    <!-- Officer Screen -->
    <div class="app-container officer-screen" id="officerScreen">
        <button class="logout-btn" id="officerLogoutBtn">LOGOUT</button>
        <h1 class="login-title">Active Emergencies</h1>
        
        <div class="officer-map" id="officerMap"></div>
        
        <div class="emergency-list" id="emergencyList">
            <!-- Emergency cards will appear here -->
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // DOM Elements
        const calculatorMode = document.getElementById('calculatorMode');
        const emergencyMode = document.getElementById('emergencyMode');
        const loginScreen = document.getElementById('loginScreen');
        const officerScreen = document.getElementById('officerScreen');
        const calcBackBtn = document.getElementById('calcBackBtn');
        const officerMap = document.getElementById('officerMap');
        
        // Calculator functionality
        const calcDisplay = document.getElementById('calcDisplay');
        const calcButtons = document.querySelectorAll('.calc-btn');
        
        // Emergency buttons
        const robberyBtn = document.getElementById('robberyBtn');
        const medicalBtn = document.getElementById('medicalBtn');
        const fireBtn = document.getElementById('fireBtn');
        const breakdownBtn = document.getElementById('breakdownBtn');
        const activeAlert = document.getElementById('activeAlert');
        const alertType = document.getElementById('alertType');
        const cancelAlertBtn = document.getElementById('cancelAlertBtn');
        
        // Login elements
        const pedestrianBtn = document.getElementById('pedestrianBtn');
        const officerBtn = document.getElementById('officerBtn');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const loginBtn = document.getElementById('loginBtn');
        const switchMode = document.getElementById('switchMode');
        
        // Officer elements
        const officerLogoutBtn = document.getElementById('officerLogoutBtn');
        const emergencyList = document.getElementById('emergencyList');
        
        // App State
        let currentUserType = 'pedestrian';
        let isLoginMode = true;
        let activeEmergency = null;
        let longPressTimer;
        let map;
        let markers = [];
        
        // Initialize the app
        function initApp() {
            // Start with login screen
            showLoginScreen();
            
            // Calculator button functionality
            calcButtons.forEach(button => {
                button.addEventListener('click', handleCalcButtonClick);
            });
            
            // Emergency buttons
            setupRobberyButton();
            
            medicalBtn.addEventListener('click', () => triggerEmergency('medical'));
            fireBtn.addEventListener('click', () => triggerEmergency('fire'));
            breakdownBtn.addEventListener('click', () => triggerEmergency('breakdown'));
            cancelAlertBtn.addEventListener('click', cancelEmergency);
            
            // Login screen
            pedestrianBtn.addEventListener('click', () => setUserType('pedestrian'));
            officerBtn.addEventListener('click', () => setUserType('officer'));
            loginBtn.addEventListener('click', handleAuth);
            switchMode.addEventListener('click', toggleAuthMode);
            
            // Officer screen
            officerLogoutBtn.addEventListener('click', logout);
            
            // Calculator back button
            calcBackBtn.addEventListener('click', () => {
                showEmergencyMode();
            });
            
            // Simulate shake detection
            window.addEventListener('devicemotion', handleShake);
        }
        
        // Setup robbery button with both click and long press
        function setupRobberyButton() {
            let isLongPress = false;
            
            robberyBtn.addEventListener('touchstart', function(e) {
                isLongPress = false;
                startLongPressTimer(e);
            });
            
            robberyBtn.addEventListener('touchend', function(e) {
                if (!isLongPress) {
                    triggerEmergency('robbery');
                }
                cancelLongPressTimer();
            });
            
            robberyBtn.addEventListener('mousedown', function(e) {
                isLongPress = false;
                startLongPressTimer(e);
            });
            
            robberyBtn.addEventListener('mouseup', function(e) {
                if (!isLongPress) {
                    triggerEmergency('robbery');
                }
                cancelLongPressTimer();
            });
            
            function startLongPressTimer(e) {
                e.preventDefault();
                longPressTimer = setTimeout(() => {
                    isLongPress = true;
                    showCalculatorMode();
                }, 1500);
            }
            
            function cancelLongPressTimer() {
                clearTimeout(longPressTimer);
            }
        }
        
        // Show different screens
        function showCalculatorMode() {
            hideAllScreens();
            calculatorMode.style.display = 'flex';
        }
        
        function showEmergencyMode() {
            hideAllScreens();
            emergencyMode.style.display = 'flex';
        }
        
        function showLoginScreen() {
            hideAllScreens();
            loginScreen.style.display = 'flex';
            // Reset form
            emailInput.value = '';
            passwordInput.value = '';
        }
        
        function showOfficerScreen() {
            hideAllScreens();
            officerScreen.style.display = 'flex';
            initMap();
            simulateIncomingEmergencies();
        }
        
        function hideAllScreens() {
            calculatorMode.style.display = 'none';
            emergencyMode.style.display = 'none';
            loginScreen.style.display = 'none';
            officerScreen.style.display = 'none';
        }
        
        // Initialize map for officer view
        function initMap() {
            if (map) map.remove();
            
            // Center on South Africa
            map = L.map('officerMap').setView([-28.4793, 24.6727], 5);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }
        
        // Add marker to map
        function addMapMarker(emergency) {
            const marker = L.marker([emergency.coords.lat, emergency.coords.lng], {
                icon: L.divIcon({
                    className: '',
                    html: `<div class="${emergency.type}-marker">${emergency.type.charAt(0).toUpperCase()}</div>`,
                    iconSize: [20, 20]
                })
            }).addTo(map);
            
            marker.bindPopup(`
                <b>${emergency.type.toUpperCase()}</b><br>
                ${emergency.location}<br>
                Reported: ${emergency.time}
            `);
            
            markers.push(marker);
        }
        
        function handleCalcButtonClick(e) {
            const value = e.target.textContent;
            handleCalcInput(value);
        }
        
        // Shake detection
        let lastShakeTime = 0;
        function handleShake(event) {
            const now = Date.now();
            if (now - lastShakeTime < 2000) return; // Debounce shakes
            
            const acceleration = event.accelerationIncludingGravity;
            const shakeThreshold = 15;
            
            if (acceleration && 
                (Math.abs(acceleration.x) > shakeThreshold || 
                 Math.abs(acceleration.y) > shakeThreshold || 
                 Math.abs(acceleration.z) > shakeThreshold)) {
                lastShakeTime = now;
                triggerEmergency('robbery');
            }
        }
        
        // Emergency functions
        function triggerEmergency(type) {
            activeEmergency = type;
            alertType.textContent = `${type.toUpperCase()} ALERT ACTIVE`;
            activeAlert.style.display = 'block';
            
            // In a real app, this would send to backend
            console.log(`Emergency triggered: ${type}`);
            
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
            
            // Simulate sending to authorities
            setTimeout(() => {
                alert(`Emergency alert sent to authorities: ${type}`);
            }, 1500);
        }
        
        function cancelEmergency() {
            activeEmergency = null;
            activeAlert.style.display = 'none';
            console.log('Emergency cancelled');
        }
        
        // Login functions
        function setUserType(type) {
            currentUserType = type;
            if (type === 'pedestrian') {
                pedestrianBtn.classList.add('active');
                officerBtn.classList.remove('active');
            } else {
                pedestrianBtn.classList.remove('active');
                officerBtn.classList.add('active');
            }
        }
        
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            loginBtn.textContent = isLoginMode ? 'LOGIN' : 'REGISTER';
            switchMode.textContent = isLoginMode 
                ? "Don't have an account? Register" 
                : "Already have an account? Login";
        }
        
        function handleAuth() {
            const email = emailInput.value;
            const password = passwordInput.value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            // In a real app, this would authenticate with backend
            console.log(`${isLoginMode ? 'Login' : 'Register'} as ${currentUserType}: ${email}`);
            
            // Simulate successful auth
            if (currentUserType === 'pedestrian') {
                showEmergencyMode(); // Show emergency screen first now
            } else {
                showOfficerScreen();
            }
        }
        
        function logout() {
            showLoginScreen();
        }
        
        // Officer functions
        function simulateIncomingEmergencies() {
            // Clear existing emergencies
            emergencyList.innerHTML = '';
            
            // Sample emergencies with coordinates for South Africa
            const emergencies = [
                { 
                    type: 'robbery', 
                    location: 'CBD, Johannesburg', 
                    time: '2 min ago',
                    coords: { lat: -26.2041, lng: 28.0473 }
                },
                { 
                    type: 'fire', 
                    location: 'V&A Waterfront, Cape Town', 
                    time: '5 min ago',
                    coords: { lat: -33.9056, lng: 18.4211 }
                },
                { 
                    type: 'medical', 
                    location: 'Sandton City Mall', 
                    time: '8 min ago',
                    coords: { lat: -26.1076, lng: 28.0567 }
                },
                { 
                    type: 'breakdown', 
                    location: 'N1 Highway near Pretoria', 
                    time: '12 min ago',
                    coords: { lat: -25.7313, lng: 28.2184 }
                },
                { 
                    type: 'robbery', 
                    location: 'Durban Beachfront', 
                    time: '15 min ago',
                    coords: { lat: -29.8516, lng: 31.0249 }
                }
            ];
            
            emergencies.forEach(emergency => {
                // Add to map
                addMapMarker(emergency);
                
                // Add to list
                const card = document.createElement('div');
                card.className = 'emergency-card';
                card.innerHTML = `
                    <div class="emergency-type">${emergency.type.toUpperCase()}</div>
                    <div>Location: ${emergency.location}</div>
                    <div>Reported: ${emergency.time}</div>
                    <button class="respond-btn">RESPOND</button>
                `;
                emergencyList.appendChild(card);
                
                // Add click handler to respond button
                card.querySelector('.respond-btn').addEventListener('click', () => {
                    alert(`You are now responding to ${emergency.type} at ${emergency.location}`);
                    // Center map on this emergency
                    map.setView([emergency.coords.lat, emergency.coords.lng], 13);
                });
            });
            
            // Fit map to show all markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.2));
            }
        }
        
        // Calculator functions
        function handleCalcInput(value) {
            if (value === '=') {
                try {
                    calcDisplay.textContent = eval(calcDisplay.textContent);
                } catch {
                    calcDisplay.textContent = 'Error';
                }
            } else if (calcDisplay.textContent === '0' || calcDisplay.textContent === 'Error') {
                calcDisplay.textContent = value;
            } else {
                calcDisplay.textContent += value;
            }
        }
        
        // Start the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>